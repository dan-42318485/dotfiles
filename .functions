#!/usr/bin/env bash

init_ssh() {
  SSH_KEY="$HOME/.ssh/dquist_rsa"
  FP=$(ssh-keygen -lf $SSH_KEY  | awk '{print $2}')
  ssh-add -l | grep -q $FP || ssh-add $SSH_KEY
}

# This fixes zsh fuzzy search which breaks with the vi-mode plugin
# start typing + [Up-Arrow] - fuzzy find history forward
fix_zsh_history() {
  if [[ "${terminfo[kcuu1]}" != "" ]]; then
    autoload -U up-line-or-beginning-search
    zle -N up-line-or-beginning-search
    bindkey "${terminfo[kcuu1]}" up-line-or-beginning-search
  fi
  # start typing + [Down-Arrow] - fuzzy find history backward
  if [[ "${terminfo[kcud1]}" != "" ]]; then
    autoload -U down-line-or-beginning-search
    zle -N down-line-or-beginning-search
    bindkey "${terminfo[kcud1]}" down-line-or-beginning-search
  fi
}

into() {
  mkdir $1
  cd $1
}

setup_common() {
  init_ssh
  fix_zsh_history
}

# Local additions - Don't edit below this line
if [[ -f ".functions.local" ]]; then
  source ".functions.local"
fi
