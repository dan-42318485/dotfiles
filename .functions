#!/usr/bin/env bash

init_ssh() {
  if [[ $0 == "-zh" ]]; then
    SSH_KEY="$HOME/.ssh/dquist_rsa"
    FP=$(ssh-keygen -lf $SSH_KEY  | awk '{print $2}')
    ssh-add -l | grep -q $FP || ssh-add $SSH_KEY
  fi
}

set_npm_path() {
  npm set prefix ~/.npm
  export PATH="$HOME/.npm/bin:$PATH"
}

wsl_only() {
  # Checks if running under WSL
  # 'uname -v' will return the kernel version in the form of
  #   #379-Microsoft Wed Mar 06 19:16:00 PST 2019
  if [[ $(uname -v | sed -rE 's/^#[0-9]{3,}-(\S+).+/\1/') == "Microsoft" ]]; then
    alias pshell="powershell.exe"
    alias cmd="cmd.exe"
  fi
}

into() {
  mkdir $1
  cd $1
}

setup_common() {
  init_ssh
  set_npm_path
  wsl_only

  umask 027
}

# Local additions - Don't edit below this line
if [[ -f ".functions.local" ]]; then
  source ".functions.local"
fi
